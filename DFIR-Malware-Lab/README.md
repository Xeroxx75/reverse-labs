# Malware Lab – GPGcryptor (Academic Ransomware)

This folder contains an academic malware analysis lab carried out at CentraleSupélec as part of a reverse engineering / malware course.

The goal of the lab is to analyze a custom ransomware sample (“GPGcryptor”), understand its behaviour (persistence, file format, crypto), and build defensive tools to clean and recover data.

> ⚠️ The original malware binary is **not** included in this repository.  
> Only analysis artefacts and defensive tools are provided, for educational purposes.

---

## Structure

- `rapport/TP_Analyse_GPGcryptor.pdf`  
  Full write-up (in French) of the analysis:
  - Process & persistence discovery
  - File format of encrypted files (`GPGcrypt` magic, `_SECRET_` tag)
  - Crypto scheme (Camellia-128 CFB, IV `#GPC0DEMAGICVAL`, key derived from SYSTEMTIME)
  - IOCs and detection ideas
  - Recovery approach and tooling

- `tools/decrypt.py`  
  Python script implementing the decryption logic described in the report.  
  It recovers the original files given a constrained time window for the key derivation.

- `tools/restauration.ps1`  
  PowerShell helper to automate restoration steps on a victim machine:
    - Stop malicious processes
    - Remove persistence entries
    - Delete malware files

---

## Technical Highlights

- **Initial triage** with tools such as Procmon to identify the malicious process and its behaviour.
- **Persistence mechanisms**: registry keys and startup folder entries used by the malware.
- **Encrypted file format**:
  - Magic bytes `GPGcrypt` and `_SECRET_` tag in the header
  - Header structure containing `SYSTEMTIME` and SHA-256 of the plaintext
  - Ciphertext encrypted with **Camellia-128 CFB** and a constant IV.

- **Recovery strategy**:
  - Bruteforce over a constrained time window (using the timestamp stored in the file header)
  - Verification with header/data integrity checks
  - Automation with Python + PowerShell.

---

## Usage Notes

- Run all scripts **only in an isolated lab environment**.  
- The goal is to demonstrate the ability to:
  - reverse engineer a lab ransomware,
  - derive IOCs and a decryptor,
  - and document the full DFIR process.
